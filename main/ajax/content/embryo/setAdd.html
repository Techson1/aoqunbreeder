<title>冲胚添加</title>
<div id="app">
    <div class="row">
        <div class="col-xs-12">
            <div class="operate">
                <center><h1>冲胚、检胚</h1></center>
                <div style="margin-top:50px;">
                    <form class="form-horizontal myform">
                        <input type="hidden" name="recorder" v-model="data5.cname">
                        <input type="hidden" name="org.id" v-if="data5.id!=null" v-model="data5.organization.id">
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="donorCode">供体耳号</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="donorCode" id="donorCode"
                                           class="col-xs-12 col-sm-6" required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                   for="date">冲胚日期</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="date" id="date"
                                           class="col-xs-12 col-sm-6 datep" required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="isEmbryoFlush">是否冲胚</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <div class="col-sm-3 col-xs-12"
                                         style="padding-left:0px;padding-right:0px;">
                                        <input name="isEmbryoFlush" type="radio" class="ace" required
                                               @click="IsSet(1)"
                                               v-if="checked='checked'" v-model="data.isEmbryoFlush"
                                               value="1"/> <span class="lbl">是</span>
                                    </div>
                                    <div class="col-sm-3 col-xs-12">
                                        <input name="isEmbryoFlush" type="radio" class="ace" required
                                                @click="IsSet(0)"
                                               v-if="checked='checked'" v-model="data.isEmbryoFlush"
                                               value="0"/> <span class="lbl">否</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                   for="purposeType">基因等级</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <select name="purposeType" id="purposeType" required>
                                        <option value="1">核心级</option>
                                        <option value="2">生产级</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="yesorno" style="border:1px solid #ccc;clear:both;height:320px;padding-top:20px;padding-bottom:20px;display:none;">
                                <div class="form-group col-sm-6">
                                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                           for="total">总胚胎数</label>
                                    <div class="col-xs-12 col-sm-7">
                                        <div class="clearfix">
                                            <input type="text" name="total" id="total"
                                                   class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group col-sm-6">
                                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                           for="usable">可用胚胎数</label>
                                    <div class="col-xs-12 col-sm-7">
                                        <div class="clearfix">
                                            <input type="text" name="usable" id="usable"
                                                   class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                        </div>
                                    </div>
                                </div>
                            <div class="form-group col-sm-6">
                                <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                       for="alevel">A级胚胎数</label>
                                <div class="col-xs-12 col-sm-7">
                                    <div class="clearfix">
                                        <input type="text" name="alevel" id="alevel"
                                               class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">
                                <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                       for="frozen">冻胚数</label>
                                <div class="col-xs-12 col-sm-7">
                                    <div class="clearfix">
                                        <input type="text" name="frozen" id="frozen"
                                               class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">
                                <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                       for="blevel">B级胚胎数</label>
                                <div class="col-xs-12 col-sm-7">
                                    <div class="clearfix">
                                        <input type="text" name="blevel" id="blevel"
                                               class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">
                                <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                       for="number">鲜胚数</label>
                                <div class="col-xs-12 col-sm-7">
                                    <div class="clearfix">
                                        <input type="text" name="number" id="number"
                                               class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-sm-6">
                                <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                       for="infertile">未受精数</label>
                                <div class="col-xs-12 col-sm-7">
                                    <div class="clearfix">
                                        <input type="text" name="infertile" id="infertile"
                                               class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-sm-6" style="height:50px;"></div>
                            <div class="form-group col-sm-6">
                                <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                       for="degenerate">退化胚胎数</label>
                                <div class="col-xs-12 col-sm-7">
                                    <div class="clearfix">
                                        <input type="text" name="degenerate" id="degenerate"
                                               class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

        <div class="col-md-12" style="margin-top: 30px;margin-bottom: 20px;">
            <center>
                <button class="btn btn-info" type="button" onclick="tj()">
                    <i class="fa fa-check bigger-110"></i>
                    <span>提交</span>
                </button>
                &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;
                <button class="btn btn-prev" type="reset" v-if="data.id==null">
                    <i class="fa fa-undo bigger-110"></i>
                    重置
                </button>
            </center>
        </div>

    <script type="text/javascript">
        var scripts = [null, "ace1.4/components/fuelux/js/wizard.js", "ace1.4/components/jquery-validation/dist/jquery.validate.js", "ace1.4/components/jquery-validation/src/localization/messages_zh.js", "ace1.4/components/jquery-validation/dist/additional-methods.js", "ace1.4/components/bootbox.js/bootbox.js", "ace1.4/components/jquery.maskedinput/dist/jquery.maskedinput.js", "ace1.4/components/select2/dist/js/select2.js", "ace1.4/components/bootstrap-datepicker/dist/js/bootstrap-datepicker.js", "ace1.4/components/bootstrap-datepicker/js/locales/bootstrap-datepicker.zh-CN.js", null]
        $('.page-content-area').ace_ajax('loadScripts', scripts, function () {
            myValidate();
        });
        var s = localStorage.deathDisposalReasonId;
        var scripts = [null, null]
        $('.page-content-area').ace_ajax('loadScripts', scripts, function () {
            jQuery(function ($) {
                initCheckBox();
                root.loadCompany();
                root.loadPama("embryoProject/one/"+s);
            })
        });
        var yesornocp
        function tj(){
            var totalembryo=parseInt($("#alevel").val())+parseInt($("#blevel").val())+parseInt($("#infertile").val())+parseInt($("#degenerate").val());
            var useEmbryo1=parseInt($("#frozen").val())+parseInt($("#number").val())
            var useEmbryo2=parseInt($("#alevel").val())+parseInt($("#blevel").val())
            if ($(".myform").valid()) {
              if(yesornocp==1){
                 // 判断总胚胎数=A级+B级+未受精+退化胚胎数
                  if(totalembryo==$("#total").val()){
                      //判断可用胚胎数=冻胚数+鲜胚数
                      if(useEmbryo1!=$("#usable").val()){
                          msg("可用胚胎数不对，冻胚数+鲜胚数="+useEmbryo1)
                      }
                      //判断可用胚胎数=A级胚胎数+B级胚胎数
                      else if(useEmbryo2!=$("#usable").val()){
                          msg("可用胚胎数不对，A级胚胎数+B级胚胎数="+useEmbryo2)
                      }
                      else{
                          //判断冻胚数<=A级胚胎数
                          if(parseInt($("#frozen").val())<=parseInt($("#alevel").val())){
                              //添加冲胚校验
                              $.post(base_url + "embryoFlush/addVerify?project.id="+s ,$(".myform").serialize(), function (data1) {
                                  if (data1.code == "101") {
                                      msg(data1.msg)
                                  }
                                  else{
                                      //添加
                                      $.post(base_url + "embryoFlush/add?project.id="+s ,$(".myform").serialize(), function (data) {
                                          if(data.code=='100'){
                                              msg("添加成功")
                                          }
                                          to("#page/embryo/embryoSet")
                                      })
                                  }
                              })
                          }
                          else{
                              msg("冻胚数应小于A级胚胎数")
                          }
                      }
                  }
                  else{
                      msg("总胚胎数不对，应为"+totalembryo)
                  }
              }else{
                  $.post(base_url + "embryoFlush/addVerify?project.id="+s ,$(".myform").serialize(), function (data1) {
                      if (data1.code == "101") {
                          msg(data1.msg)
                      }
                      else{
                          //添加
                          $.post(base_url + "embryoFlush/add?project.id="+s ,$(".myform").serialize(), function (data) {
                              if(data.code=='100'){
                                  msg("添加成功")
                              }
                              to("#page/embryo/embryoSet")
                          })
                      }
                  })
              }

            }
        }

        //是否冲胚
        function IsSet(t){
            if(t=='1'){
                $("#yesorno").show();
                yesornocp=1;
            }
            else{
                $("#yesorno").hide();
                yesornocp=0;
            }
        }
    </script>
    <script src="js/base-vue.js"></script>
