<title>冻胚制作</title>
<div id="app">
    <div class="row">
        <div class="col-xs-12">
            <div class="operate">
                <center><h1>冲胚、检胚</h1></center>
                <div style="margin-top:50px;">
                    <input type="hidden" name="recorder" v-model="data5.cname">
                    <input type="hidden" name="org.id" v-if="data5.id!=null" v-model="data5.organization.id">
                    <input type="hidden" name="embryoFlushId" v-model="data1.id">
                    <input type="hidden" name="breedId" v-if="data1.joining!=null" v-model="data1.joining.childBreed.id">
                    <div class="form-group col-sm-6">
                        <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                               for="donor">母羊耳号</label>
                        <div class="col-xs-12 col-sm-7">
                            <div class="clearfix">
                                <input type="text" name="donor" id="donor" readonly="readonly" v-if="data1.id!=null" v-model="data1.donor.code"
                                       class="col-xs-12 col-sm-6 " required maxlength="14"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                               for="date">冲胚日期</label>
                        <div class="col-xs-12 col-sm-7">
                            <div class="clearfix">
                                <input type="text" name="date" id="date" readonly="readonly"  v-model="data1.date"
                                       class="col-xs-12 col-sm-6" required maxlength="14"/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                               for="joiningDate">是否冲胚</label>
                        <div class="col-xs-12 col-sm-7">
                            <div class="clearfix">
                                <div class="col-sm-3 col-xs-12"
                                     style="padding-left:0px;padding-right:0px;">
                                    <input name="accountType" type="radio" required
                                           id="accountType"  disabled
                                           v-if="data1.isEmbryoFlush=='1'" checked="true"/>
                                    <input type="radio" v-else>
                                    <span class="lbl">是</span>
                                </div>
                                <div class="col-sm-3 col-xs-12">
                                    <input name="accountType" type="radio" required
                                           id="accountType"  disabled
                                           v-if="data1.isEmbryoFlush=='0'" checked="true"/>
                                    <input type="radio" v-else>
                                    <span class="lbl">否</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                               for="purposeType">基因等级</label>
                        <div class="col-xs-12 col-sm-7">
                            <div class="clearfix">
                                <select name="purposeType" id="purposeType" disabled="disabled">
                                    <option v-if="data1.purposeType=='1'" selected="selected">核心级</option>
                                    <option v-if="data1.purposeType=='2'" selected="selected">生产级</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div style="border:1px solid #ccc;clear:both;height:320px;padding-top:20px;padding-bottom:20px;">
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="total">总胚胎数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="total" id="total" readonly="readonly"
                                           v-model="data1.total"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                   for="usable">可用胚胎数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="usable" id="usable" readonly="readonly"  v-model="data1.usable"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="alevel">A级胚胎数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="alevel" id="alevel" readonly="readonly"  v-model="data1.alevel"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                   for="frozen">冻胚数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="frozen" id="frozen" readonly="readonly"  v-model="data1.frozen"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="blevel">B级胚胎数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="blevel" id="blevel" readonly="readonly"  v-model="data1.blevel"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                                   for="number">鲜胚数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="number" id="number" readonly="readonly"  v-model="data1.number"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="infertile">未受精数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="infertile" id="infertile" readonly="readonly"  v-model="data1.infertile"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-sm-6" style="height:50px;"></div>
                        <div class="form-group col-sm-6">
                            <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:70px;"
                                   for="degenerate">退化胚胎数</label>
                            <div class="col-xs-12 col-sm-7">
                                <div class="clearfix">
                                    <input type="text" name="degenerate" id="degenerate" readonly="readonly"  v-model="data1.degenerate"
                                           class="col-xs-12 col-sm-6 " required maxlength="14"/>
                                </div>
                            </div>
                        </div>

                    </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <form class="form-horizontal myform">
                <input type="hidden" name="recorder" v-model="data5.cname">
                <input type="hidden" name="org.id"  v-if="data5.id!=null" v-model="data5.organization.id">
                <input type="hidden" name="embryoFlush.id" v-model="data1.id">
                <div class="form-group col-sm-6">
                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:90px;"
                           for="freezeDate">冷冻日期</label>
                    <div class="col-xs-12 col-sm-7">
                        <div class="clearfix">
                            <input type="text" name="freezeDate" id="freezeDate" readonly="readonly" v-model="data1.date"
                                   class="col-xs-12 col-sm-6 datep" required/>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-6">
                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                           for="tubuleCode">胚胎细管编号</label>
                    <div class="col-xs-12 col-sm-7">
                        <div class="clearfix">
                            <input type="text" name="tubuleCode" id="tubuleCode" readonly="readonly"
                                   class="col-xs-12 col-sm-6" required maxlength="14"/>
                            <button class="btn btn-xs btn-success"
                                    style="padding:1px 5px;border-radius:5px;margin-left:10px;height:30px;"
                                    type="button" onclick="getuse()">生成编号</button>
                            <button class="btn btn-xs btn-success"
                                    style="padding:1px 5px;border-radius:5px;margin-left:10px;height:30px;"
                                    type="submit" onclick="checkTime()">打印编号</button>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-6">
                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:90px;"
                           for="tubuleColor">细管颜色</label>
                    <div class="col-xs-12 col-sm-7">
                        <div class="clearfix">
                            <select name="tubuleColor" id="tubuleColor" class="col-sm-6 col-xs-12">
                                <option value="">请选择</option>
                                <option value="blue">蓝色</option>
                                <option value="yellow">黄色</option>
                                <option value="white">白色</option>
                                <option value="pink">粉色</option>
                                <option value="red">红色</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-6">
                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                           for="drivepipeColor">套管颜色</label>
                    <div class="col-xs-12 col-sm-7">
                        <div class="clearfix">
                            <select name="drivepipeColor" id="drivepipeColor" class="col-sm-6 col-xs-12">
                                <option value="">请选择</option>
                                <option value="blue">蓝色</option>
                                <option value="yellow">黄色</option>
                                <option value="white">白色</option>
                                <option value="pink">粉色</option>
                                <option value="red">红色</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-6">
                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-3" style="width:90px;"
                           for="usableNumber">冷冻胚胎数</label>
                    <div class="col-xs-12 col-sm-7">
                        <div class="clearfix">
                            <input type="text" name="usableNumber" id="usableNumber"
                                   class="col-xs-12 col-sm-6" required digits="true"/>
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-6">
                    <label class="control-label col-xs-12 col-sm-2 col-sm-offset-1"
                           for="frozenStore.id">存储罐号</label>
                    <div class="col-xs-12 col-sm-7">
                        <div class="clearfix">
                            <select class="col-xs-12 col-sm-6" name="frozenStore.id" required
                                    id="breed">
                                <option value="">请选择</option>
                                <option v-for="frozenStore in data8" :value="frozenStore.id">
                                    {{frozenStore.name}}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>
            <div class="col-md-12" style="margin-top: 30px;margin-bottom: 20px;">
                <center>
                    <button class="btn btn-info" type="button" onclick="tj()">
                        <i class="fa fa-check bigger-110"></i>
                        <span>提交</span>
                    </button>
                </center>
            </div>

        </div>


        <div class="col-xs-12">
            <table id="simple-table" class="table  table-bordered table-hover">
                <thead>
                <tr>
                    <!--<th class="center">-->
                        <!--<label class="pos-rel">-->
                            <!--<input type="checkbox" class="ace"/>-->
                            <!--<span class="lbl"></span>-->
                        <!--</label>-->
                    <!--</th>-->
                    <th>细管号</th>
                    <th>冷冻日期</th>
                    <th>冷冻胚胎数</th>
                    <th>细管颜色</th>
                    <th>套管颜色</th>
                    <th>存储罐号</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="frozenEmbryo in data.content">
                    <!--<td class="center">-->
                        <!--<label class="pos-rel">-->
                            <!--<input type="checkbox" class="ace prid" :value="frozenEmbryo.id"/>-->
                            <!--<span class="lbl"></span>-->
                        <!--</label>-->
                    <!--</td>-->
                    <td>{{frozenEmbryo.tubuleCode}}</td>
                    <td>{{frozenEmbryo.freezeDate}}</td>
                    <td class="usable">{{frozenEmbryo.usableNumber}}</td>
                    <td>
                        <span v-if="frozenEmbryo.tubuleColor=='blue'">蓝色</span>
                        <span v-if="frozenEmbryo.tubuleColor=='yellow'">黄色</span>
                        <span v-if="frozenEmbryo.tubuleColor=='white'">白色</span>
                        <span v-if="frozenEmbryo.tubuleColor=='pink'">粉色</span>
                        <span v-if="frozenEmbryo.tubuleColor=='red'">红色</span>
                    </td>
                    <td>
                        <span v-if="frozenEmbryo.drivepipeColor=='blue'">蓝色</span>
                        <span v-if="frozenEmbryo.drivepipeColor=='yellow'">黄色</span>
                        <span v-if="frozenEmbryo.drivepipeColor=='white'">白色</span>
                        <span v-if="frozenEmbryo.drivepipeColor=='pink'">粉色</span>
                        <span v-if="frozenEmbryo.drivepipeColor=='red'">红色</span>
                   </td>
                    <td>{{frozenEmbryo.frozenStore.name}}</td>
                    <td>
                    	<button class="btn btn-xs btn-success"
                            style="padding:1px 5px;border-radius:5px;margin-left:10px;height:30px;"
                            type="button" @click="updateFrozen(frozenEmbryo.id)">修改
                    	</button>
                    	<button class="btn btn-xs btn-success"
                            style="padding:1px 5px;border-radius:5px;margin-left:10px;height:30px;"
                            type="button" @click="deleteFrozen(frozenEmbryo.id)">刪除
                    	</button>
                    </td>
                    
                </tr>
                </tbody>
            </table>
        </div>


    </div>



    <script type="text/javascript">
        var scripts = [null, "ace1.4/components/fuelux/js/wizard.js", "ace1.4/components/jquery-validation/dist/jquery.validate.js", "ace1.4/components/jquery-validation/src/localization/messages_zh.js", "ace1.4/components/jquery-validation/dist/additional-methods.js", "ace1.4/components/bootbox.js/bootbox.js", "ace1.4/components/jquery.maskedinput/dist/jquery.maskedinput.js", "ace1.4/components/select2/dist/js/select2.js", "ace1.4/components/bootstrap-datepicker/dist/js/bootstrap-datepicker.js", "ace1.4/components/bootstrap-datepicker/js/locales/bootstrap-datepicker.zh-CN.js", null]
        $('.page-content-area').ace_ajax('loadScripts', scripts, function () {
            myValidate();
        });
        localStorage.url_list = "frozenEmbryo/list?embryoFlush.id="+s;
        var s = localStorage.xdid;
        var scripts = [null, null]
        $('.page-content-area').ace_ajax('loadScripts', scripts, function () {
            jQuery(function ($) {
                initCheckBox();
                root.loadPama("embryoFlush/one/"+s);
                root.loadCompany();
                root.loadPama1('frozenStore/findBy/'+JSON.parse(localStorage.userInfo).organization.id);
            })
        });
        //生成编号
        function getuse(){
            po(getUrl("embryoRegistration/getIsUse?breedId="+$("input[name=breedId]").val()),function(data){
                if(data.code=='100'){
                    $("#tubuleCode").val(data.msg)
                }
                else{
                    msg(data.msg)
                }
            })
        }
		
		//修改
		function updateFrozen(id){
						
		}
		
		//刪除
		function deleteFrozen(id){
			$.post(base_url+"frozenEmbryo/delVerify/"+id,function(data){
				if (data.code=='101'){
					msg(data.msg);
				}
				else{
					root.load();
				}
			});
		}

        //提交
        function tj(){
            var t=1;
            if ($(".myform").valid()) {
                if($("input[name=usableNumber]").val()=='0'){
                    msg("冷冻胚胎数不能为0")
                }else{
                    var fla=0;
                    $("table").find("tbody").find("tr").each(function(){
                        fla+=parseFloat($(this).children(".usable").text());
                    });
                    fla+=parseInt($("input[name=usableNumber]").val());
                    if(fla>$("#frozen").val()){
                        msg("冷冻胚胎数不能大于冻胚数")
                        $("input[name='usableNumber']").val("")
                        t=0;
                    }
                    if(t==1){
                        po(getUrl("frozenEmbryo/add"), $(".myform").serialize(), function(data){
                            if(data.code=='100'){
                                msg("添加成功")
                                root.load();
                            }
                        })
                    }
                }

            }
        }
    </script>
    <script src="js/base-vue.js"></script>
